#!/usr/bin/env zsh
set -euo pipefail

TARGET=x86_64-w64-mingw32
WINDOWS_TARGET=0x0603
local -a COMMON_ARGS

if [ ! -z ${WINDIR:-} ]; then
    GCC_VERSION=5.2.1
    GCC_ROOT=C:/mingw-w64-$GCC_VERSION
    COMMON_ARGS+=(--sysroot $GCC_ROOT)
    export PATH=$(cygpath -u $GCC_ROOT/bin):$PATH
else
    PATH=/opt/clang/bin:$PATH
fi

COMMON_ARGS+=(-target $TARGET -DWINVER=$WINDOWS_TARGET -D_WIN32_WINNT=$WINDOWS_TARGET -static)

case $0 in
    *-clang)
        clang -std=c11 $COMMON_ARGS "$@"
        ;;
    *-clang++)
        clang++ -std=c++14 $COMMON_ARGS "$@"
        ;;
    *)
        echo "Unknown command ${0:t}"
        ;;
esac
