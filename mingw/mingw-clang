#!/usr/bin/env zsh
set -euo pipefail

TARGET=x86_64-w64-mingw32
WINDOWS_TARGET=0x0603
local -a COMMON_ARGS
local -a CFLAGS CXXFLAGS WARNING_FLAGS

CFLAGS+=("-std=c11")
CXXFLAGS+=("-stdlib=libstdc++" "-std=c++14")
WARNING_FLAGS+=(-Weverything -Wno-c++98-compat -Wno-c++98-compat-pedantic)
COMMON_ARGS+=(-target $TARGET -DWINVER=$WINDOWS_TARGET -D_WIN32_WINNT=$WINDOWS_TARGET)

case $0 in
    *-clang)
        clang $CFLAGS $COMMON_ARGS $WARNING_FLAGS "$@"
        ;;
    *-clang++)
        clang++ $CXXFLAGS $COMMON_ARGS $WARNING_FLAGS "$@"
        ;;
    *)
        echo "Unknown command ${0:t}"
        ;;
esac
